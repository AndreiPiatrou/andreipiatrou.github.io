---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

const allPosts = await getCollection('blog');
const sortedPosts = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
};
---

<BaseLayout title="Engineer's blog">
  <div class="container">
    <header class="site-header">
      <h1 class="site-title">Engineer's blog</h1>
      <p class="site-description">A repository for my thoughts, knowledge, and ideas that I want to share.</p>
    </header>

    <main>
      <div class="posts">
        {sortedPosts.map(post => {
          const slug = post.id.replace('.md', '');
          return (
            <article class="post-item">
              <time class="post-date" datetime={post.data.date.toISOString()}>
                {formatDate(post.data.date)}
              </time>
              <h2 class="post-title">
                <a href={`/blog/${slug}`}>{post.data.title}</a>
              </h2>
              {post.data.description && (
                <p class="post-preview">{post.data.description}</p>
              )}
              {post.data.tags && post.data.tags.length > 0 && (
                <div class="post-tags">
                  {post.data.tags.map(tag => <span class="tag">{tag}</span>)}
                </div>
              )}
            </article>
          );
        })}
      </div>
    </main>

    <footer class="site-footer">
      <p>
        <a href="https://github.com/andreipiatrou" target="_blank" rel="noopener">GitHub</a>
        <span class="separator">â€¢</span>
        <a href="https://www.linkedin.com/in/andrei-piatrou" target="_blank" rel="noopener">LinkedIn</a>
      </p>
    </footer>
  </div>

  <style>
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 3rem 1.5rem;
    }

    .site-header {
      margin-bottom: 4rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid var(--border-color);
    }

    .site-title {
      font-size: 2.5rem;
      margin: 0 0 0.5rem;
    }

    .site-description {
      color: var(--text-muted);
      font-size: 1.1rem;
      margin: 0;
    }

    .posts {
      display: flex;
      flex-direction: column;
      gap: 2.5rem;
    }

    .post-item {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .post-date {
      color: var(--text-muted);
      font-size: 0.9rem;
      letter-spacing: 0.5px;
    }

    .post-title {
      margin: 0;
      font-size: 1.75rem;
      font-weight: 600;
    }

    .post-title a {
      border: none;
      transition: opacity 0.2s;
    }

    .post-title a:hover {
      opacity: 0.7;
    }

    .post-preview {
      color: var(--text-muted);
      margin: 0.25rem 0 0;
      line-height: 1.6;
    }

    .post-meta {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .post-tags {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .tag {
      background-color: var(--code-bg);
      padding: 0.25rem 0.75rem;
      border-radius: 3px;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .site-footer {
      margin-top: 5rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border-color);
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .separator {
      margin: 0 0.5rem;
    }

    @media (max-width: 768px) {
      .container {
        padding: 2rem 1rem;
      }

      .site-header {
        margin-bottom: 3rem;
      }

      .site-title {
        font-size: 2rem;
      }

      .post-title {
        font-size: 1.5rem;
      }
    }
  </style>
</BaseLayout>

<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="This is a repository for my thoughts, knowledge, and ideas that I want to share."><title>JS tips and tricks</title><style>*{margin:0;padding:0;box-sizing:border-box}:root{--bg-color: #0a0a0a;--text-color: #e0e0e0;--text-muted: #888;--accent-color: #fff;--border-color: #222;--code-bg: #1a1a1a}body{background-color:var(--bg-color);color:var(--text-color);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;line-height:1.6;font-size:16px}a{color:var(--text-color);text-decoration:none;border-bottom:1px solid var(--border-color);transition:border-color .2s}a:hover{border-bottom-color:var(--accent-color)}h1,h2,h3,h4,h5,h6{margin:1.5em 0 .5em;line-height:1.3;font-weight:600}h1{font-size:2em}h2{font-size:1.5em}h3{font-size:1.25em}p{margin:1em 0}ul,ol{margin:1em 0;padding-left:2em}li{margin:.5em 0}code{background-color:var(--code-bg);padding:.2em .4em;border-radius:3px;font-family:Courier New,monospace;font-size:.9em}pre{background-color:var(--code-bg);padding:1em;border-radius:5px;overflow-x:auto;margin:1em 0}pre code{padding:0;background:none}blockquote{border-left:3px solid var(--border-color);padding-left:1em;margin:1em 0;color:var(--text-muted)}hr{border:none;border-top:1px solid var(--border-color);margin:2em 0}img{max-width:100%;height:auto}table{width:100%;border-collapse:collapse;margin:1em 0}th,td{padding:.5em;border:1px solid var(--border-color);text-align:left}th{background-color:var(--code-bg)}
.container[data-astro-cid-bvzihdzo]{max-width:800px;margin:0 auto;padding:2rem 1.5rem}.site-header[data-astro-cid-bvzihdzo]{margin-bottom:3rem;padding-bottom:1rem;border-bottom:1px solid var(--border-color)}.site-title[data-astro-cid-bvzihdzo]{font-size:1.5rem;margin:0}.site-title[data-astro-cid-bvzihdzo] a[data-astro-cid-bvzihdzo]{border:none}.post[data-astro-cid-bvzihdzo]{margin-bottom:3rem}.post-header[data-astro-cid-bvzihdzo]{margin-bottom:2rem}.post-title[data-astro-cid-bvzihdzo]{margin:0 0 .5rem;font-size:2.5rem}.post-meta[data-astro-cid-bvzihdzo]{color:var(--text-muted);font-size:.95rem}.post-tags[data-astro-cid-bvzihdzo]{margin-top:.75rem;display:flex;gap:.5rem;flex-wrap:wrap}.tag[data-astro-cid-bvzihdzo]{background-color:var(--code-bg);padding:.25rem .75rem;border-radius:3px;font-size:.85rem;color:var(--text-muted)}.post-content[data-astro-cid-bvzihdzo]{margin:2rem 0}.post-footer[data-astro-cid-bvzihdzo]{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border-color)}.back-link[data-astro-cid-bvzihdzo]{color:var(--text-muted);border:none;transition:color .2s}.back-link[data-astro-cid-bvzihdzo]:hover{color:var(--accent-color)}@media(max-width:768px){.container[data-astro-cid-bvzihdzo]{padding:1.5rem 1rem}.post-title[data-astro-cid-bvzihdzo]{font-size:2rem}}
</style></head> <body>  <div class="container" data-astro-cid-bvzihdzo> <header class="site-header" data-astro-cid-bvzihdzo> <h1 class="site-title" data-astro-cid-bvzihdzo><a href="/" data-astro-cid-bvzihdzo>Engineer's blog</a></h1> </header> <article class="post" data-astro-cid-bvzihdzo> <header class="post-header" data-astro-cid-bvzihdzo> <h1 class="post-title" data-astro-cid-bvzihdzo>JS tips and tricks</h1> <div class="post-meta" data-astro-cid-bvzihdzo> <time datetime="2018-06-20T00:00:00.000Z" data-astro-cid-bvzihdzo>June 20, 2018</time> </div> <div class="post-tags" data-astro-cid-bvzihdzo> <span class="tag" data-astro-cid-bvzihdzo>js</span> </div> </header> <div class="post-content" data-astro-cid-bvzihdzo>  <h2 id="named-functions">Named functions</h2>
<p>Named JS functions as callback or predicates make code more readable and stack trace more clear:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// I know, this case is too trivial but it reveals the main idea </span></span>
<span class="line"><span style="color:#B392F0">ajax</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">data</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> template.</span><span style="color:#B392F0">bind</span><span style="color:#E1E4E8">(data));</span></span>
<span class="line"><span style="color:#6A737D">// vs</span></span>
<span class="line"><span style="color:#B392F0">ajax</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">function</span><span style="color:#B392F0"> bindToTemplate</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">data</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">  template.</span><span style="color:#B392F0">bind</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h2 id="function-parameters-aggregation">Function parameters aggregation</h2>
<p>Destructive/spread operators make arguments passing more declarative and do not bring any complexity</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> foo</span><span style="color:#E1E4E8">({ </span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {}) {</span></span>
<span class="line"><span style="color:#F97583">  ...</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> foo</span><span style="color:#E1E4E8">([ </span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8"> ] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []) {</span></span>
<span class="line"><span style="color:#F97583">  ...</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> foo</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">...</span><span style="color:#FFAB70">args</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  ...</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span></code></pre>
<h2 id="named-argumentsparameters">Named arguments/parameters</h2>
<p>In case a function has a lot of arguments or, for example, most of them are optional, making a function unary and passing a single object is an option for such cases.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> foo</span><span style="color:#E1E4E8">({ </span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">z</span><span style="color:#E1E4E8"> }) {</span></span>
<span class="line"><span style="color:#F97583"> ...</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">foo</span><span style="color:#E1E4E8">({ y: </span><span style="color:#9ECBFF">'y'</span><span style="color:#E1E4E8"> });</span></span></code></pre>
<h2 id="constants">Constants</h2>
<p><code>const</code> identifier does not make a variable <em>constant</em>, it just tells that it can not be reassiggned, but a variable mutation is allowed.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> a</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> { b: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#E1E4E8">a.b </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(a.b); </span><span style="color:#6A737D">// 2</span></span></code></pre>
<p>And <code>Object.freeze(..)</code> can help you in this approach:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> a</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> Object.</span><span style="color:#B392F0">freeze</span><span style="color:#E1E4E8">({ b: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">a.b </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// Error</span></span></code></pre>
<p><code>Object.freeze(..)</code> makes an object immutable at its first root level, nested objects should be <em>freezed</em> as well in case you need this. This behavior can be achieved with some custom recursion function or with a third party library.</p>
<h2 id="purity-and-mutations">Purity and mutations</h2>
<p>The best choise for developer that wants to create a readable and clean code is immutability. Utilities like <code>[...arr]</code> and <code>Object.assign({}, obj)</code> may help you do achieve this goal but this approach leads to extra CPU and memory consumption. So that the best choise it using more sophisticated structures like ones from <a href="https://github.com/facebook/immutable-js/issues">Immutable.js</a>. It introduces structures like <code>Map</code> and <code>List</code> that can help you in real immutability.</p>
<h2 id="recursion">Recursion</h2>
<p>Everybody knows about recursion and its side effects that touch call stack size and memory consumption. But there are a couple of techniques on the field that can elimitate them and make your code more readable and declarative.</p>
<h3 id="proper-tail-calls-ptc"><a href="https://github.com/getify/Functional-Light-JS/blob/master/manuscript/ch8.md/#proper-tail-calls-ptc">Proper Tail Calls (PTC)</a></h3>
<p>These are not PTC:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">foo</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">// or</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">=</span><span style="color:#B392F0"> foo</span><span style="color:#E1E4E8">( .. );</span></span>
<span class="line"><span style="color:#F97583">return</span><span style="color:#E1E4E8"> x;</span></span>
<span class="line"><span style="color:#6A737D">// or</span></span>
<span class="line"><span style="color:#F97583">return</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583"> +</span><span style="color:#B392F0"> foo</span><span style="color:#E1E4E8">( .. );</span></span></code></pre>
<p>However, this is PTC:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">return</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">?</span><span style="color:#B392F0"> foo</span><span style="color:#E1E4E8">( .. ) </span><span style="color:#F97583">:</span><span style="color:#B392F0"> bar</span><span style="color:#E1E4E8">( .. );</span></span></code></pre>
<h3 id="continuation-passing-style-cps"><a href="https://github.com/getify/Functional-Light-JS/blob/master/manuscript/ch8.md/#continuation-passing-style-cps">Continuation Passing Style (CPS)</a></h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#9ECBFF">"use strict"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> fib</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">n</span><span style="color:#E1E4E8">,</span><span style="color:#FFAB70">cont</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> identity) {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (n </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">return</span><span style="color:#B392F0"> cont</span><span style="color:#E1E4E8">( n );</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> fib</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">        n </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">        n2</span><span style="color:#F97583"> =></span><span style="color:#B392F0"> fib</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">            n </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">            n1</span><span style="color:#F97583"> =></span><span style="color:#B392F0"> cont</span><span style="color:#E1E4E8">( n2 </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> n1 )</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#E1E4E8">    );</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="trampolines"><a href="https://github.com/getify/Functional-Light-JS/blob/master/manuscript/ch8.md/#trampolines">Trampolines</a></h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> trampoline</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">fn</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> function</span><span style="color:#B392F0"> trampolined</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">...</span><span style="color:#FFAB70">args</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        var</span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">=</span><span style="color:#B392F0"> fn</span><span style="color:#E1E4E8">( </span><span style="color:#F97583">...</span><span style="color:#E1E4E8">args );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        while</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">typeof</span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> "function"</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            result </span><span style="color:#F97583">=</span><span style="color:#B392F0"> result</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// and then</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> sum </span><span style="color:#F97583">=</span><span style="color:#B392F0"> trampoline</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#F97583">    function</span><span style="color:#B392F0"> sum</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">num1</span><span style="color:#E1E4E8">,</span><span style="color:#FFAB70">num2</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">...</span><span style="color:#FFAB70">nums</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        num1 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> num1 </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> num2;</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (nums.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ==</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8"> num1;</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> sum</span><span style="color:#E1E4E8">( num1, </span><span style="color:#F97583">...</span><span style="color:#E1E4E8">nums );</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> xs </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 20000</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    xs.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">( i );</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="true-functional-filter"><a href="https://github.com/getify/Functional-Light-JS/blob/master/manuscript/ch9.md/#filtering-confusion">True functional <code>filter()</code></a></h2>
<p>The most interesting question about <code>filter()</code> is how <em>predicate</em> function should be named? For example:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">].</span><span style="color:#B392F0">filter</span><span style="color:#E1E4E8">( isOdd );</span></span>
<span class="line"><span style="color:#6A737D">// and</span></span>
<span class="line"><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">].</span><span style="color:#B392F0">filter</span><span style="color:#E1E4E8">( isEven );</span></span></code></pre>
<p>It is not clear what exactly we want to do with our input: <em>filter out</em> or <em>filter in</em>, do we want to <em>GET</em> or <em>SKIP</em> some array elements. Functional programming patterns and most libraries promote next implementation:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">filterIn</span><span style="color:#E1E4E8">( isOdd, [</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">] );         </span><span style="color:#6A737D">// [1,3,5]</span></span>
<span class="line"><span style="color:#B392F0">filterOut</span><span style="color:#E1E4E8">( isEven, [</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">] );       </span><span style="color:#6A737D">// [1,3,5]</span></span></code></pre>
<blockquote>
<p>To clear up all this confusion, let’s define a filterOut(..) that actually filters out values by internally negating the predicate check. While we’re at it, we’ll alias filterIn(..) to the existing filter(..):</p>
</blockquote>
<h2 id="fusion"><a href="https://github.com/getify/Functional-Light-JS/blob/master/manuscript/ch9.md/#fusion">Fusion</a></h2>
<p>Imagine we have some array <code>filter / map</code> chain like this:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">someList</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">filter</span><span style="color:#E1E4E8">(..)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">filter</span><span style="color:#E1E4E8">(..)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">(..)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">(..)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">(..)</span></span>
<span class="line"><span style="color:#E1E4E8">  .</span><span style="color:#B392F0">reduce</span><span style="color:#E1E4E8">(..);</span></span></code></pre>
<p>It looks pretty nice but its performance is not hte best - we do one extra <code>filter</code> <code>forEach</code> and twu extra <code>map</code> <code>forEach</code>. To avoid this percormance suffering we can combine these <code>filter</code> and <code>map</code> predicate calls into one function per operator. For example:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">var</span><span style="color:#B392F0"> removeInvalidChars</span><span style="color:#F97583"> =</span><span style="color:#FFAB70"> str</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> str.</span><span style="color:#B392F0">replace</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF"> /</span><span style="color:#79B8FF">[</span><span style="color:#F97583">^</span><span style="color:#79B8FF">\w]</span><span style="color:#F97583">*</span><span style="color:#9ECBFF">/</span><span style="color:#F97583">g</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8"> );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#B392F0"> upper</span><span style="color:#F97583"> =</span><span style="color:#FFAB70"> str</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> str.</span><span style="color:#B392F0">toUpperCase</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#B392F0"> elide</span><span style="color:#F97583"> =</span><span style="color:#FFAB70"> str</span><span style="color:#F97583"> =></span></span>
<span class="line"><span style="color:#E1E4E8">    str.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ></span><span style="color:#79B8FF"> 10</span><span style="color:#F97583"> ?</span></span>
<span class="line"><span style="color:#E1E4E8">        str.</span><span style="color:#B392F0">substr</span><span style="color:#E1E4E8">( </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8"> ) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "..."</span><span style="color:#F97583"> :</span></span>
<span class="line"><span style="color:#E1E4E8">        str;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> words </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Mr. Jones isn't responsible for this disaster!"</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">split</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF"> /</span><span style="color:#79B8FF">\s</span><span style="color:#9ECBFF">/</span><span style="color:#E1E4E8"> );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">words;</span></span>
<span class="line"><span style="color:#6A737D">// ["Mr.","Jones","isn't","responsible","for","this","disaster!"]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">words</span></span>
<span class="line"><span style="color:#E1E4E8">.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">( removeInvalidChars )</span></span>
<span class="line"><span style="color:#E1E4E8">.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">( upper )</span></span>
<span class="line"><span style="color:#E1E4E8">.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">( elide );</span></span>
<span class="line"><span style="color:#6A737D">// ["MR","JONES","ISNT","RESPONS...","FOR","THIS","DISASTER"]</span></span></code></pre>
<p>Every array item goes through next chain:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">elide</span><span style="color:#E1E4E8">( </span><span style="color:#B392F0">upper</span><span style="color:#E1E4E8">( </span><span style="color:#B392F0">removeInvalidChars</span><span style="color:#E1E4E8">( </span><span style="color:#9ECBFF">"Mr."</span><span style="color:#E1E4E8"> ) ) );</span></span>
<span class="line"><span style="color:#6A737D">// "MR"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">elide</span><span style="color:#E1E4E8">( </span><span style="color:#B392F0">upper</span><span style="color:#E1E4E8">( </span><span style="color:#B392F0">removeInvalidChars</span><span style="color:#E1E4E8">( </span><span style="color:#9ECBFF">"responsible"</span><span style="color:#E1E4E8"> ) ) );</span></span>
<span class="line"><span style="color:#6A737D">// "RESPONS..."</span></span></code></pre>
<p>You may already catched the point that we can <code>pipe</code> all this <code>map()</code> predicates with <code>pipe</code>, do not like <code>compose</code> personally, so let’s do it with <code>pipe</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">words</span></span>
<span class="line"><span style="color:#E1E4E8">.</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#B392F0">    pipe</span><span style="color:#E1E4E8">( removeInvalidChars, upper, elide )</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">// ["MR","JONES","ISNT","RESPONS...","FOR","THIS","DISASTER"]</span></span></code></pre>
<p>We got the same result by more efficient, declarative and performance-wise way.</p>  </div> <footer class="post-footer" data-astro-cid-bvzihdzo> <a href="/" class="back-link" data-astro-cid-bvzihdzo>← Back to all posts</a> </footer> </article> </div>   </body></html>
<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="This is a repository for my thoughts, knowledge, and ideas that I want to share."><title>How to work with updatable collections</title><style>*{margin:0;padding:0;box-sizing:border-box}:root{--bg-color: #0a0a0a;--text-color: #e0e0e0;--text-muted: #888;--accent-color: #fff;--border-color: #222;--code-bg: #1a1a1a}body{background-color:var(--bg-color);color:var(--text-color);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;line-height:1.6;font-size:16px}a{color:var(--text-color);text-decoration:none;border-bottom:1px solid var(--border-color);transition:border-color .2s}a:hover{border-bottom-color:var(--accent-color)}h1,h2,h3,h4,h5,h6{margin:1.5em 0 .5em;line-height:1.3;font-weight:600}h1{font-size:2em}h2{font-size:1.5em}h3{font-size:1.25em}p{margin:1em 0}ul,ol{margin:1em 0;padding-left:2em}li{margin:.5em 0}code{background-color:var(--code-bg);padding:.2em .4em;border-radius:3px;font-family:Courier New,monospace;font-size:.9em}pre{background-color:var(--code-bg);padding:1em;border-radius:5px;overflow-x:auto;margin:1em 0}pre code{padding:0;background:none}blockquote{border-left:3px solid var(--border-color);padding-left:1em;margin:1em 0;color:var(--text-muted)}hr{border:none;border-top:1px solid var(--border-color);margin:2em 0}img{max-width:100%;height:auto}table{width:100%;border-collapse:collapse;margin:1em 0}th,td{padding:.5em;border:1px solid var(--border-color);text-align:left}th{background-color:var(--code-bg)}
.container[data-astro-cid-bvzihdzo]{max-width:800px;margin:0 auto;padding:2rem 1.5rem}.site-header[data-astro-cid-bvzihdzo]{margin-bottom:3rem;padding-bottom:1rem;border-bottom:1px solid var(--border-color)}.site-title[data-astro-cid-bvzihdzo]{font-size:1.5rem;margin:0}.site-title[data-astro-cid-bvzihdzo] a[data-astro-cid-bvzihdzo]{border:none}.post[data-astro-cid-bvzihdzo]{margin-bottom:3rem}.post-header[data-astro-cid-bvzihdzo]{margin-bottom:2rem}.post-title[data-astro-cid-bvzihdzo]{margin:0 0 .5rem;font-size:2.5rem}.post-meta[data-astro-cid-bvzihdzo]{color:var(--text-muted);font-size:.95rem}.post-tags[data-astro-cid-bvzihdzo]{margin-top:.75rem;display:flex;gap:.5rem;flex-wrap:wrap}.tag[data-astro-cid-bvzihdzo]{background-color:var(--code-bg);padding:.25rem .75rem;border-radius:3px;font-size:.85rem;color:var(--text-muted)}.post-content[data-astro-cid-bvzihdzo]{margin:2rem 0}.post-footer[data-astro-cid-bvzihdzo]{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border-color)}.back-link[data-astro-cid-bvzihdzo]{color:var(--text-muted);border:none;transition:color .2s}.back-link[data-astro-cid-bvzihdzo]:hover{color:var(--accent-color)}@media(max-width:768px){.container[data-astro-cid-bvzihdzo]{padding:1.5rem 1rem}.post-title[data-astro-cid-bvzihdzo]{font-size:2rem}}
</style></head> <body>  <div class="container" data-astro-cid-bvzihdzo> <header class="site-header" data-astro-cid-bvzihdzo> <h1 class="site-title" data-astro-cid-bvzihdzo><a href="/" data-astro-cid-bvzihdzo>Engineer's blog</a></h1> </header> <article class="post" data-astro-cid-bvzihdzo> <header class="post-header" data-astro-cid-bvzihdzo> <h1 class="post-title" data-astro-cid-bvzihdzo>How to work with updatable collections</h1> <div class="post-meta" data-astro-cid-bvzihdzo> <time datetime="2018-01-02T00:00:00.000Z" data-astro-cid-bvzihdzo>January 2, 2018</time> </div> <div class="post-tags" data-astro-cid-bvzihdzo> <span class="tag" data-astro-cid-bvzihdzo>emberjs</span> </div> </header> <div class="post-content" data-astro-cid-bvzihdzo>  <h2 id="use-case">Use case</h2>
<p>Usually, you work with EmberJS Data Model collections and have to display some list of entities, create, edit and delete them in different routes, for example, there is a table in one root route and some child modal route that should create/edit/delete entities.</p>
<h2 id="question">Question</h2>
<p>How to organize the model collection, that should be binded on the view and updated outside of parent route without model reload?</p>
<h2 id="variant-1">Variant #1</h2>
<p>Create a <code>service</code>, with, for example, <code>store</code> method:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// users-store-service.js</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> Ember.Service.</span><span style="color:#B392F0">extend</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">    users: </span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B392F0">    save</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">users</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">set</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'users'</span><span style="color:#E1E4E8">, users.</span><span style="color:#B392F0">toArray</span><span style="color:#E1E4E8">()); </span><span style="color:#6A737D">// make sure that usual array will be stored instead of data store collection</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'users'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#B392F0">    add</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">user</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'users'</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">addObject</span><span style="color:#E1E4E8">(user);</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#B392F0">    delete</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">user</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'users'</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">removeObject</span><span style="color:#E1E4E8">(user);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>and use this implementation like following:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// route.js</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> Ember.Route.</span><span style="color:#B392F0">extend</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">    usersStoreService: Ember.inject.</span><span style="color:#B392F0">service</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#B392F0">    model</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> Ember.</span><span style="color:#79B8FF">RSVP</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">hash</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">            users: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.store.</span><span style="color:#B392F0">findAll</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">users</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'usersStoreService'</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">save</span><span style="color:#E1E4E8">(users))</span></span>
<span class="line"><span style="color:#E1E4E8">        })</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// controller.js</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> Ember.Controller.</span><span style="color:#B392F0">extend</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">    usersStoreService: Ember.inject.</span><span style="color:#B392F0">service</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// user-create-controller.js</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> Ember.Controller.</span><span style="color:#B392F0">extend</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">    usersStoreService: Ember.inject.</span><span style="color:#B392F0">service</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#E1E4E8">    actions: {</span></span>
<span class="line"><span style="color:#B392F0">        save</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#79B8FF">            this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'model'</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">save</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">user</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">                this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'usersStoreService'</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(user);</span></span>
<span class="line"><span style="color:#79B8FF">                this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">transitionTo</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'users'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">            };</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="hbs"><code><span class="line"><span style="color:#E1E4E8">// users.hbs</span></span>
<span class="line"><span style="color:#E1E4E8">{% raw %}</span><span style="color:#79B8FF">{{</span><span style="color:#FFAB70">table</span><span style="color:#FFAB70"> records</span><span style="color:#B392F0">=</span><span style="color:#FFAB70">model.users</span><span style="color:#79B8FF"> }}</span><span style="color:#E1E4E8">{% endraw %}</span></span></code></pre>
<p>Since all routes, controllers and services are singletons - ti allows us to do such things. But in this case we have to create a lot of addition code, maintain it, cover by tests and so on.</p>
<h2 id="varian-2">Varian #2</h2>
<p>Use <code>RecordsArray</code> and <code>peekAll</code> method:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// route.js</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> Ember.Route.</span><span style="color:#B392F0">extend</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#B392F0">	beforeModel</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">_super</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">...</span><span style="color:#79B8FF">arguments</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">		// upload all records to prevent wrong records fetching in model hook</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.store.</span><span style="color:#B392F0">unloadAll</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'users'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	},</span></span>
<span class="line"><span style="color:#B392F0">	model</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">		return</span><span style="color:#E1E4E8"> Ember.</span><span style="color:#79B8FF">RSVP</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">hash</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#6A737D">			// here you can use any query method too.</span></span>
<span class="line"><span style="color:#E1E4E8">			users: </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.store.</span><span style="color:#B392F0">findAll</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'users'</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.store.</span><span style="color:#B392F0">peekAll</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'users'</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#E1E4E8">		});</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">//controller.js</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> Ember.Controller.</span><span style="color:#B392F0">extend</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#6A737D">    // note, how computed property is created</span></span>
<span class="line"><span style="color:#E1E4E8">    users: Ember.</span><span style="color:#B392F0">computed</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'model.users.@each.isNew'</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">function</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">        // here you can place any filter/sort logic that you want to perform on the client side.</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'model.users'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="hbs"><code><span class="line"><span style="color:#E1E4E8">// users.hbs</span></span>
<span class="line"><span style="color:#E1E4E8">{% raw %}</span><span style="color:#79B8FF">{{</span><span style="color:#FFAB70">table</span><span style="color:#FFAB70"> records</span><span style="color:#B392F0">=</span><span style="color:#FFAB70">users</span><span style="color:#79B8FF"> }}</span><span style="color:#E1E4E8">{% endraw %}</span></span></code></pre>
<p><code>RecordsArray</code> is an array from the <code>store</code> and this array gets updated on <code>record.destroyRecord()</code> and <code>record.save()</code> actions, so your view and computed properties will be updated and you do not need to take care of manual <code>model</code> reload or something else.</p>  </div> <footer class="post-footer" data-astro-cid-bvzihdzo> <a href="/" class="back-link" data-astro-cid-bvzihdzo>‚Üê Back to all posts</a> </footer> </article> </div>   </body></html>